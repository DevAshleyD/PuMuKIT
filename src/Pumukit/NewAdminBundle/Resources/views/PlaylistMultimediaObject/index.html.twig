{% extends 'PumukitNewAdminBundle::layout.html.twig' %}
{% block javascripts %}
  {{ parent() }}
  <script src="{{ asset('/bundles/pumukitnewadmin/js/playlistmms.js') }}"></script>
{% endblock %}
{% block body %}
  <h3 class="cab_body_div">
    <a title="{% trans %}Back to playlist list{% endtrans %}" href="{{ path('pumukitnewadmin_playlist_index') }}" class="btn btn-pumukit btn-raised pull-right">
      {% trans %}Â« Back to playlist{% endtrans %}
    </a>
    <ul class="breadcrumb" style="margin-bottom: 5px;">
      <li><a href="{{ path('pumukitnewadmin_playlist_index') }}">Playlist{% if app.user and is_granted(constant('Pumukit\\SchemaBundle\\Security\\Permission::ACCESS_MULTIMEDIA_SERIES')) %} ({{ playlist.getTitle() }}){% endif %}</a></li>
      <li class="active">Multimedia Objects</li>
    </ul>
    {% if app.user and is_granted(constant('Pumukit\\SchemaBundle\\Security\\Permission::ACCESS_MULTIMEDIA_SERIES')) %}
      <input type="hidden" name="playlist_id" id="mms_playlist_id" value="{{ playlist.id }}" />
    {% endif %}
  </h3>

  <div class="row">
    {% if app.user and is_granted(constant('Pumukit\\SchemaBundle\\Security\\Permission::ACCESS_MULTIMEDIA_SERIES')) %}
      <div id="tv_admin_content" class="col-md-10">
        <div class="well">
          <div id="list_mms">
            {% include 'PumukitNewAdminBundle:PlaylistMultimediaObject:list.html.twig' %}
          </div>
          <div class="row">
            <div class="col-md-2">
              <select id="options_mms" class="form-control" title="{% trans %}Actions on selected items{% endtrans %}" onchange="window.change_select('mm', $(this), 'mms', '{{playlist.id}}');">
                <option value="default" selected="selected">{% trans %}Select an action{% endtrans %}...</option>
                <option disabled="">---</option>
                <option value="delete_selected">{% trans %}Delete selected{% endtrans %}</option>
                <option value="invert_announce_selected">{% trans %}Announce/Not announce selected{% endtrans %}</option>
                <option disabled="">---</option>
                <option value="order_pub_date_desc">{% trans %}List multimedia objects in descending order of publication date{% endtrans %}</option>
                <option value="order_pub_date_asc">{% trans %}List multimedia objects in ascending order of publication date{% endtrans %}</option>
                <option value="order_rec_date_desc">{% trans %}List multimedia objects in descending order of recording date{% endtrans %}</option>
                <option value="order_rec_date_asc">{% trans %}List multimedia objects in ascending order of recording date{% endtrans %}</option>
                <option disabled="">---</option>
                <option value="cut_mm">{% trans %}Cut multimedia objects{% endtrans %}</option>
                {% if app.session.has('admin/mms/cut') and app.session.get('admin/mms/cut')%}
                  <option value="paste_mm" id="paste_mm">
                    {% trans %}Paste multimedia objects{% endtrans %} ({% for id in app.session.get('admin/mms/cut') %}{{ id }}{% if not loop.last %},&nbsp;{% endif %}{% endfor %})
                  </option>
                {% else %}
                  <option value="paste_mm" id="paste_mm" style="display:none"></option>
                {% endif %}
                <option disabled="">---</option>
                <option value="playlist_preview" id="{{ playlist.secret }}">{% trans %}Preview show of the playlist{% endtrans %}</option>
              </select>
            </div>
            <div class="col-md-10 text-right">
	      <a title="{% trans %}Add multimedia object{% endtrans %}"
                 class="btn btn-pumukit btn-raised"
                 href="{#CHANGE FOR ACTUAL URL#}https://pumukit2.armazeg.org/app_dev.php/admin/playlist/mms/modal"
                 data-toggle="modal"
                 data-backdrop="static"
                 data-target="#myModal">
                {% trans %}Add{% endtrans %}
              </a>
            </div>
          </div>
        </div>
        <div id="edit_mm">
          {% if(app.session.has('admin/playlist/id') and app.session.has('admin/playlistmms/id')) %}
            {{ render(url('pumukitnewadmin_mms_edit', {'id': app.session.get('admin/playlistmms/id'), 'playlistId': app.session.get('admin/playlist/id')})) }}
          {% endif %}
        </div>
      </div>

      <div id="tv_admin_bar" class="col-md-2">
        <div id="preview_mm" class="well">
          {% if(app.session.has('admin/playlistmms/id')) %}
            {{ render_hinclude(url('pumukitnewadmin_mms_show', {'id': app.session.get('admin/playlistmms/id')})) }}
          {% else %}
            {% trans %}Select any multimedia object.{% endtrans %}
          {% endif %}
        </div>
      </div>
    {% else %}
      <div class="col-md-12">
        <div class="well">
          {% trans %}You don't have enough permissions to access this content.{% endtrans %}
        </div>
      </div>
    {% endif %}
  </div>

  <div class="modal fade" id="myAuxModal" tabindex="-1" role="dialog" aria-labelledby="myAuxModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
      </div>
    </div>
  </div>

  {% if app.user and is_granted(constant('Pumukit\\SchemaBundle\\Security\\Permission::ACCESS_MULTIMEDIA_SERIES')) %}
    <script type="text/javascript">
     window.update_preview_mms = function(id) {
         var route = "{{ path('pumukitnewadmin_mms_show', {id: '__id__'}) }}";
         $.ajax({
             url: route.replace('__id__', id),
             type: 'POST',
             success: function(response){$('#preview').html(response);}
         });
     }
    </script>
  {% endif %}
{% endblock %}
