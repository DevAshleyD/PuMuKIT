
{% set criteria = false %}
{% if app.request.session.has('UNESCO/form') %}
    {% set criteria = app.request.session.get('UNESCO/form') %}
{% endif %}

<div class="well">
    <div class="row">

        <form id="myForm" class="unesco_form" name="advance_form" method="POST" action="{{ path('pumukitnewadmin_unesco_list') }}">
            <div class="col-xs-12">
                <div id="basic_form">
                    {% include 'PumukitNewAdminBundle:UNESCO:basic_form.html.twig' %}
                </div>
            </div>
            <div class="col-xs-12">
                <div class="advance_form collapse {% if app.request.session.get('UNESCO/formbasic') is same as(false) %}in{% endif %}" id="collapseAdvanceForm">
                    {% include 'PumukitNewAdminBundle:UNESCO:advance_form.html.twig' %}
                </div>
            </div>

            <div class="col-xs-12">
                <a class="unescoResetForm" href="#">{% trans %}Reset{% endtrans %}</a>
            </div>
        </form>
    </div>
</div>


<script type="text/javascript">

    $('#collapseAdvanceForm').on('show.bs.collapse', function () {
        $('#submitBasicForm').attr('disabled',true);
    });

    $('#collapseAdvanceForm').on('hide.bs.collapse', function () {
        $('#submitBasicForm').attr('disabled', false);
    });

    $('.unesco_form').on('submit',function(event) {
        event.preventDefault();
        $.ajax({
            url: '{{ path('pumukitnewadmin_unesco_addcriteria') }}',
            method: 'POST',
            data: $(this).serialize(),
            success: function (response) {
                $('#list_mms').load("{{ path('pumukitnewadmin_unesco_list') }}");
                $.ajax({
                   url: "{{ path('pumukitnewadmin_unesco_get_mmo_selected') }}",
                   method: 'POST',
                   success: function(response) {
                       if(response.id) {
                           console.log('entra en2 ajax');
                           var path = "{{ path('pumukit_new_admin_unesco_edit', {'id' : '__ID__'}) }}";
                           path = path.replace('__ID__', response.id);
                           $('#edit_mms').load(path);
                           var url = "{{ path('pumukitnewadmin_unesco_show', {'id' : '__ID__'}) }}";
                           url = url.replace('__ID__', response.id);
                           $('#preview_mms').load(url);
                       } else {
                           console.log(' no entra en2 ajax');
                           $('#edit_mms').html('');
                           $('#preview_mms').load("{{ path('pumukitnewadmin_unesco_show') }}");
                       }
                   }
                });
            },
            error: function (response) {
                alert('error');
            }
        });
        return false;
    });

</script>